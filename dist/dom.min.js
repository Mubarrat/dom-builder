/*!
 * Dom-Builder JavaScript Library v3.0.1
 * https://github.com/Mubarrat/dom-builder/
 * 
 * Released under the MIT license
 * https://github.com/Mubarrat/dom-builder/blob/main/LICENSE
 */
function base_observable(e,t){return e.subscribe=e=>(t.add(e),()=>t.delete(e)),e.notify=()=>t.forEach(t=>t(e())),e.bind=()=>({[Symbol.observable]:"one-way",target:e}),e.bindSelect=t=>t.computed(e).bind(),e.bindMap=t=>e.bindSelect(e=>{if(null==e||"function"!=typeof e[Symbol.iterator])throw new Error("bindMap requires an iterable (Array, Set, Generator, etc.)");const r=[];for(const o of e)r.push(t(o));return r}),e}function observable(e=null){let t=e;const r=base_observable(function(e){return 0!==arguments.length&&t!==e&&(t=e,r.notify()),t},new Set);return r.bindToSource=()=>({[Symbol.observable]:"to-source",target:r}),r.bindTwoWay=()=>({[Symbol.observable]:"two-way",target:r}),r}function validatable(e=()=>!0,t=null){const r=observable(t);return r.isValid=(()=>e(r())).computed(r),r}Symbol.observable=Symbol("observable"),Function.prototype.computed=function(...e){const t=base_observable(this,new Set);return e.forEach(e=>e.subscribe(t.notify)),t},Object.defineProperties(Document.prototype,{$dom:{value(e){return new Proxy({},{get:(t,r)=>{const o=r.replace(/([A-Z])/g,"-$1").toLowerCase();return(...t)=>{const r=this.createElementNS(e,o);for(const e of t.flat(1/0))if(null!=e&&!1!==e)if(e.constructor===Object){for(const[t,o]of Object.entries(e))if("style"===t)switch(o?.[Symbol.observable]){case"one-way":Object.assign(r.style,o.target()),o.target.subscribe(e=>Object.assign(r.style,e));break;case"to-source":case"two-way":throw new Error("Two-way style binding not supported");default:if("object"==typeof o)for(const[e,t]of Object.entries(o))"one-way"===t?.[Symbol.observable]?(r.style[e]=t.target(),t.target.subscribe(t=>r.style[e]=t)):r.style[e]=t}else if("on"===t&&"object"==typeof o)for(const[e,t]of Object.entries(o))for(const o of[t].flat(1/0))"function"==typeof o&&r.addEventListener(e.toLowerCase(),o);else if(t.startsWith("on"))for(const e of[o].flat(1/0))"function"==typeof e&&r.addEventListener(t.slice(2).toLowerCase(),e);else if("data"===t&&"object"==typeof o)for(const e in o){const t=o[e],a=t=>r.dataset[e]="object"==typeof t?JSON.stringify(t):t;switch(t?.[Symbol.observable]){case"one-way":a(t.target()),t.target.subscribe(a);break;case"to-source":a(t.target()),new MutationObserver(()=>{const o=r.dataset[e];try{t.target(JSON.parse(o))}catch{t.target(o)}}).observe(r,{attributes:!0,attributeFilter:[`data-${e}`]});break;case"two-way":a(t.target()),t.target.subscribe(a),new MutationObserver(()=>{const o=r.dataset[e];try{t.target(JSON.parse(o))}catch{t.target(o)}}).observe(r,{attributes:!0,attributeFilter:[`data-${e}`]});break;default:a(t)}}else if(t.toLowerCase().startsWith("ref"))for(const e of[o].flat(1/0))"function"==typeof e&&e.bind(r,r);else if("value"===t&&(r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement))switch(o?.[Symbol.observable]){case"one-way":r.value=o.target(),o.target.subscribe(e=>r.value=e);break;case"to-source":r.value=o.target(),r.addEventListener(r instanceof HTMLSelectElement?"change":"input",()=>o.target(r.value));break;case"two-way":r.value=o.target(),o.target.subscribe(e=>r.value=e),r.addEventListener(r instanceof HTMLSelectElement?"change":"input",()=>o.target(r.value));break;default:r.value=o}else if("checked"===t&&r instanceof HTMLInputElement&&("checkbox"===r.type||"radio"===r.type))switch(o?.[Symbol.observable]){case"one-way":r.checked=o.target(),o.target.subscribe(e=>r.checked=e);break;case"to-source":r.checked=o.target(),r.addEventListener("change",()=>o.target(r.checked));break;case"two-way":r.checked=o.target(),o.target.subscribe(e=>r.checked=e),r.addEventListener("change",()=>o.target(r.checked));break;default:r.checked=o}else if(void 0!==o){const e=e=>{t in r?r[t]=e:r.setAttribute(t,"object"==typeof e?JSON.stringify(e):e)};switch(o?.[Symbol.observable]){case"one-way":e(o.target()),o.target.subscribe(e);break;case"to-source":e(o.target()),new MutationObserver(()=>{let e=t in r?r[t]:r.getAttribute(t);try{o.target(JSON.parse(e))}catch{o.target(e)}}).observe(r,{attributes:!0,attributeFilter:[t],attributeOldValue:!0});break;case"two-way":e(o.target()),o.target.subscribe(e),new MutationObserver(()=>{let e=t in r?r[t]:r.getAttribute(t);try{o.target(JSON.parse(e))}catch{o.target(e)}}).observe(r,{attributes:!0,attributeFilter:[t],attributeOldValue:!0});break;default:e(o)}}}else if("one-way"===e?.[Symbol.observable]&&"function"==typeof e.target){const t=this.createTextNode("");r.append(t);let o=[];const a=()=>{for(const e of o)e.remove();o=[];let r=e.target();for(;"function"==typeof r;)r=r();const a=this.createDocumentFragment(),n=[r];for(;n.length;){let e=n.pop();if(null==e||!1===e)continue;for(;"function"==typeof e;)e=e();if(e&&"function"==typeof e[Symbol.iterator]){n.push(...Array.from(e).reverse());continue}const t=e instanceof Node?e:this.createTextNode(String(e));o.push(t),a.appendChild(t)}t.after(a)};a(),e.target.subscribe(a)}else{const t=[e];for(;t.length;){let e=t.pop();if(null!=e&&!1!==e){for(;"function"==typeof e;)e=e();e&&"function"==typeof e[Symbol.iterator]?t.push(...Array.from(e).reverse()):r.append(e instanceof Node?e:this.createTextNode(String(e)))}}}return r}}})},configurable:!1,enumerable:!0},$html:{get(){return this.$html=this.$dom("http://www.w3.org/1999/xhtml")},configurable:!1,enumerable:!0},$svg:{get(){return this.$svg=this.$dom("http://www.w3.org/2000/svg")},configurable:!1,enumerable:!0},$mml:{get(){return this.$mml=this.$dom("http://www.w3.org/1998/Math/MathML")},configurable:!1,enumerable:!0}}),Object.defineProperties(Window.prototype,{$dom:{get(){return this.document.$dom},configurable:!1,enumerable:!0},$html:{get(){return this.document.$html},configurable:!1,enumerable:!0},$svg:{get(){return this.document.$svg},configurable:!1,enumerable:!0},$mml:{get(){return this.document.$mml},configurable:!1,enumerable:!0}});
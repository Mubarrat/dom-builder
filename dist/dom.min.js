/*!
 * Dom-Builder JavaScript Library v4.0.0
 * https://github.com/Mubarrat/dom-builder/
 * 
 * Released under the MIT license
 * https://github.com/Mubarrat/dom-builder/blob/main/LICENSE
 */
/// <reference path="./dom.d.ts" />
"use strict";class ValueChangeEvent extends Event{constructor(e,t,r){super(e,r),t&&Object.assign(this,t)}}const baseObservable=function(e){const t=(...t)=>e(...t);return Object.setPrototypeOf(t,baseObservable.prototype),t._eventTarget=new EventTarget,(t.bind=Object.create(baseObservable.prototype.bind)).__observable__=t,t};Object.setPrototypeOf(baseObservable.prototype,EventTarget.prototype),Object.setPrototypeOf(baseObservable,EventTarget),baseObservable.prototype.addEventListener=function(...e){return this._eventTarget.addEventListener(...e)},baseObservable.prototype.removeEventListener=function(...e){return this._eventTarget.removeEventListener(...e)},baseObservable.prototype.dispatchEvent=function(...e){return this._eventTarget.dispatchEvent(...e)},Object.defineProperties(baseObservable.prototype,{type:{value:"to",writable:!1,configurable:!1,enumerable:!0},[Symbol.toStringTag]:{value:"baseObservable",writable:!1,configurable:!1,enumerable:!1}}),baseObservable.prototype.notifyBefore=function(e){return this.dispatchEvent(new ValueChangeEvent("valuechanging",e,{cancelable:!0}))},baseObservable.prototype.notify=function(e){this.dispatchEvent(new ValueChangeEvent("valuechanged",e))},baseObservable.prototype.tryChange=function(e,t){if(!this.notifyBefore(t))return;const r=e();return this.notify(t),r},baseObservable.prototype.validatable=function(e=()=>!0){return Object.setPrototypeOf(Object.assign((...e)=>this(...e),{isValid:(()=>e(this())).computed(this)}),this)},baseObservable.prototype.coercible=function(e=e=>e){return Object.setPrototypeOf((...t)=>{if(0===t.length)return this();const r=e(...t);return Array.isArray(r)?this(...r):this(r)},this)},baseObservable.prototype.bind=new Proxy({__observable__:baseObservable.prototype,select(e){return(()=>e(this.__observable__())).computed(this.__observable__)}},{get(e,t,r){if(t in e)return Reflect.get(e,t,r);const n=e.__observable__();return t in n?"function"==typeof n[t]?(...r)=>e.select(e=>e[t](...r)):e.select(e=>e[t]):void 0}}),baseObservable.autoBind=(e,t,r)=>{if(!(e instanceof baseObservable))return t(e),()=>{};t(e());const n=()=>t(e());return"to"!==e.type&&"two-way"!==e.type||e.addEventListener("valuechanged",n),"from"!==e.type&&"two-way"!==e.type||r?.(e()),()=>{"to"!==e.type&&"two-way"!==e.type||e.removeEventListener("valuechanged",n)}};const arrayObservable=function(e){const t="number"==typeof e?new Array(e).fill(void 0):Array.from(e),r=baseObservable(()=>[...t]);Object.setPrototypeOf(r,arrayObservable.prototype);const n=new Proxy(r,{get(e,r,n){switch(r){case"push":return(...r)=>e.tryChange(()=>t.push(...r),{index:t.length,newItems:r})??t.length;case"pop":return()=>{if(0!==t.length)return e.tryChange(()=>t.pop(),{index:t.length-1,oldItems:[t[t.length-1]]})};case"shift":return()=>{if(0!==t.length)return e.tryChange(()=>t.shift(),{index:0,oldItems:[t[0]]})};case"unshift":return(...r)=>e.tryChange(()=>t.unshift(...r),{index:0,newItems:r})??t.length;case"splice":return(r,n,...o)=>(r<0&&(r=t.length+r),void 0===n&&(n=t.length-r),e.tryChange(()=>t.splice(r,n,...o),{index:r,newItems:o.length?o:void 0,oldItems:t.slice(r,r+n)})??[]);case"reverse":return()=>(e.tryChange(()=>t.reverse(),{reversed:!0}),n);case"sort":return r=>{if(!e.notifyBefore({sortFn:r||null}))return n;const o=t.map((e,t)=>({v:e,i:t}));o.sort((e,t)=>r?r(e.v,t.v):e.v>t.v?1:e.v<t.v?-1:0);for(let e=0;e<t.length;e++)t[e]=o[e].v;const s=o.map(e=>e.i);return e.notify({sortedIndices:s}),n};case"fill":return(r,o,s)=>(null==o&&(o=0),null==s&&(s=t.length),e.tryChange(()=>t.fill(r,o,s),{index:o,newItems:Array(s-o).fill(r),oldItems:t.slice(o,s)}),n);case"copyWithin":return(r,o,s)=>(null==o&&(o=0),null==s&&(s=t.length),e.tryChange(()=>t.copyWithin(r,o,s),{index:r,newItems:t.slice(o,s),oldItems:t.slice(r,r+(s-o))}),n);default:return Reflect.get(t,r,n)??Reflect.get(e,r,n)}},set(e,r,n,o){if("string"==typeof r){const o=Number(r);if(Number.isInteger(o)&&o>=0&&String(o)===r&&!Object.is(t[o],n))return e.tryChange(()=>(t[o]=n,!0),{index:o,newItems:[n],oldItems:[t[o]]})??!1}if("length"===r){const r=t.length,o=Number(n);return e.tryChange(()=>(t.length=o,!0),o<r?{index:o,oldItems:t.slice(o)}:{index:r,newItems:Array(o-r)})??!1}return Reflect.set(e,r,n,o)},has(e,r){if("length"===r)return!0;if("string"==typeof r){const e=Number(r);if(Number.isInteger(e)&&e>=0&&String(e)===r)return e<t.length}return r in e},deleteProperty(e,r){if("string"==typeof r){const n=Number(r);if(Number.isInteger(n)&&n>=0&&String(n)===r)return e.tryChange(()=>(t[n]=void 0,!0),{index:n,oldItems:[t[n]],newItems:[void 0]})??!1}return Reflect.deleteProperty(e,r)},ownKeys:e=>Array.from({length:t.length},(e,t)=>t.toString()).concat(Object.getOwnPropertyNames(e)),getOwnPropertyDescriptor(e,r){if("string"==typeof r){const e=Number(r);if(Number.isInteger(e)&&e>=0&&String(e)===r)return{configurable:!0,enumerable:!0,value:t[e],writable:!0}}return"length"===r?{configurable:!0,enumerable:!1,value:t.length,writable:!0}:Object.getOwnPropertyDescriptor(e,r)}});return r.bind=Object.create(arrayObservable.prototype.bind),r.bind.__observable__=n,n};Object.setPrototypeOf(arrayObservable.prototype,baseObservable.prototype),Object.setPrototypeOf(arrayObservable,baseObservable),Object.defineProperties(arrayObservable.prototype,{[Symbol.species]:{get:()=>arrayObservable,enumerable:!1,configurable:!1},[Symbol.toStringTag]:{value:"arrayObservable",writable:!1,enumerable:!1,configurable:!1}}),arrayObservable.prototype.optimistic=function(e,t){const r=[],n=e=>r.push(e);return this.addEventListener("valuechanged",n),e(this),this.removeEventListener("valuechanged",n),t.catch(e=>{for(let e=r.length-1;e>=0;e--){const t=r[e];if("index"in t)this.splice(t.index,t.newItems?.length??0,...t.oldItems??[]);else if("reversed"in t)this.reverse();else if("sortedIndices"in t){const e=new Array(t.sortedIndices.length);for(let r=0;r<t.sortedIndices.length;r++)e[t.sortedIndices[r]]=r;const r=new Map;this.forEach((t,n)=>r.set(t,e[n])),this.sort((e,t)=>r.get(e)-r.get(t))}}throw e})},arrayObservable.prototype.bind=Object.create(baseObservable.prototype.bind),arrayObservable.prototype.bind.__observable__=arrayObservable.prototype,arrayObservable.prototype.bind.map=function(e){const t=arrayObservable(this.__observable__.map((t,r)=>e.call(this.__observable__,t,r,this.__observable__))),r=new WeakRef(t);new FinalizationRegistry(()=>this.__observable__.removeEventListener("valuechanged",n)).register(t,r);const n=t=>{const n=r.deref();if(n){if("index"in t){const{index:r,newItems:o,oldItems:s}=t;(s&&s.length||o&&o.length)&&n.splice(r,s?.length??0,...o?.map((t,n)=>e.call(this.__observable__,t,r+n,this.__observable__))??[])}"reversed"in t&&n.reverse(),"sortFn"in t&&n.sort(t.sortFn)}};return this.__observable__.addEventListener("valuechanged",n),new Proxy(t,{get:(e,t,r)=>["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"].includes(String(t))?()=>{throw new Error("Cannot modify a read-only mapped observable")}:Reflect.get(e,t,r),set(e,t,r,n){if("string"==typeof t){const e=Number(t);if(Number.isInteger(e)&&e>=0&&String(e)===t)throw new Error("Cannot modify any item of a read-only mapped observable")}if("length"===t)throw new Error("Cannot modify length of a read-only mapped observable");return Reflect.set(e,t,r,n)}})};{const e=new FinalizationRegistry(({observers:e,listener:t})=>e.forEach(e=>e.removeEventListener("valuechanged",t)));Function.prototype.computed=function(...t){const r=baseObservable(this),n=new WeakRef(r),o={},s=()=>{const r=n.deref();r?r.notify():(t.forEach(e=>e.removeEventListener("valuechanged",s)),e.unregister(o))};return t.forEach(e=>{e instanceof baseObservable&&e.addEventListener("valuechanged",s)}),e.register(r,{observers:t,listener:s},o),Object.setPrototypeOf(r,Function.prototype.computed.prototype),r}}function cstr(e,...t){const r=t.filter(e=>e instanceof baseObservable);return 0===r.length?e.reduce((e,r,n)=>e+r+(n<t.length?String(t[n]):""),""):(()=>{let r=e[0];for(let n=0;n<t.length;n++){const o=t[n];r+=String(o instanceof baseObservable?o():o),r+=e[n+1]}return r}).computed(...r)}Object.setPrototypeOf(Function.prototype.computed.prototype,baseObservable.prototype),Object.setPrototypeOf(Function.prototype.computed,baseObservable),Object.defineProperty(Function.prototype.computed.prototype,Symbol.toStringTag,{value:"computed",writable:!1,enumerable:!1,configurable:!1});{const e=new WeakMap;new MutationObserver(t=>t.forEach(t=>e.get(t.target)?.get(t.attributeName)?.forEach(e=>e()))).observe(document,{attributes:!0,subtree:!0});var observeElementAttr=(t,r,n)=>{let o=e.get(t);o||e.set(t,o=new Map);let s=o.get(r);s||o.set(r,s=new Set),s.add(n)}}Object.defineProperties(Document.prototype,{$dom:{get(){return e=>new Proxy({},{get:(t,r)=>{if("string"!=typeof r)return;if("toString"===r)return()=>`DOM Proxy for namespace: ${e}`;const n=r.replace(/([A-Z])/g,"-$1").toLowerCase();return(...t)=>{const r=this.createElementNS(e,n);for(const i of s(t))if(null!=i&&!1!==i)if(i.constructor===Object&&void 0===i[Symbol.iterator]&&Symbol.asyncIterator&&void 0===i[Symbol.asyncIterator])for(const[l,b]of Object.entries(i))if("style"===l&&r instanceof HTMLElement)baseObservable.autoBind(b,e=>"string"==typeof e?r.setAttribute("style",e):Object.entries(e).forEach(([e,t])=>baseObservable.autoBind(t,t=>r.style[e]=t,()=>observeElementAttr(r,"style",()=>t(r.style[e])))),e=>observeElementAttr(r,"style",()=>b("string"==typeof e?r.getAttribute("style")||"":Object.assign({},r.style))));else if("on"===l&&"object"==typeof b&&b)for(const[c,f]of Object.entries(b))for(const u of s([f]))"function"==typeof u&&r.addEventListener(c.toLowerCase(),u);else if(l.startsWith("on"))for(const p of s([b]))"function"==typeof p&&r.addEventListener(l.slice(2).toLowerCase(),p);else if("data"===l&&"object"==typeof b&&(r instanceof HTMLElement||r instanceof SVGElement||r instanceof MathMLElement))for(const[y,v]of Object.entries(b))baseObservable.autoBind(v,e=>r.dataset[y]="object"==typeof e?JSON.stringify(e):e,e=>observeElementAttr(r,`data-${y.replace(/([A-Z])/g,"-$1").toLowerCase()}`,()=>{const e=r.dataset[y];try{v(JSON.parse(e))}catch{v(e)}}));else"value"===l&&(r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement)?baseObservable.autoBind(b,e=>r.value=e,()=>r.addEventListener(r instanceof HTMLSelectElement?"change":"input",()=>b(r.value))):"checked"===l&&r instanceof HTMLInputElement&&("checkbox"===i.type||"radio"===i.type)?baseObservable.autoBind(b,e=>r.checked=e,()=>r.addEventListener("change",()=>b(r.checked))):void 0!==b&&baseObservable.autoBind(b,e=>{if(l in r)try{return void(r[l]=e)}catch{}r.setAttribute(l,"object"==typeof e?JSON.stringify(e):e)},()=>{let e=l in r?r[l]:r.getAttribute(l);try{b(JSON.parse(e))}catch{b(e)}});else if(i instanceof baseObservable)if(i instanceof arrayObservable){const d=new Text;r.append(d);const g=[],h=e=>{for(;"function"==typeof e;)e=e.call(r,r);return a(e).filter(e=>null!=e&&!1!==e)};i().forEach((e,t)=>{const r=new Text;g.push(r),d.before(r,...h(e))});const m=()=>g.map((e,t)=>{const r=g[t+1]||d,n=[];for(let t=e;t&&t!==r;t=t.nextSibling)n.push(t);return n}),O=e=>{const t=m();for(let r of e)for(let e of t[r])d.before(e);g.splice(0,g.length,...e.map(e=>g[e]))};function w(e){if("index"in e){const{index:t,oldItems:r,newItems:n}=e;if(r?.length){const e=g[t],n=g[t+r.length]||d;let o=e;for(;o&&o!==n;){const e=o.nextSibling;o.remove(),o=e}g.splice(t,r.length)}if(n?.length){const e=[],r=[];for(let t of n){const n=new Text;e.push(n),r.push(n,...h(t))}(g[t]||d).before(...r),g.splice(t,0,...e)}}else"reversed"in e?O([...g.keys()].reverse()):"sortedIndices"in e&&O(e.sortedIndices)}i.addEventListener("valuechanged",e=>w(e))}else{const _=new Text;r.append(_);let E=[];function j(){for(const e of E)e.remove();let e=i();for(;"function"==typeof e;)e=e.call(r,r);const t=new DocumentFragment;t.append(...a(e).filter(e=>null!=e&&!1!==e)),E=Array.from(t.childNodes),_.after(t)}j(),i.addEventListener("valuechanged",j)}else Symbol.asyncIterator?function e(t,n){for(const o of a(t).filter(e=>null!=e&&!1!==e&&void 0!==e))if("function"==typeof o[Symbol.asyncIterator]){const t=new Text;n?n.before(t):r.append(t),(async()=>{for await(const r of o)e(r,t)})()}else n?n.before(o):r.append(o)}(i):r.append(...a(i).filter(e=>null!=e&&!1!==e));return r;function o(e){return!(null==e||"string"==typeof e||"function"==typeof e||"function"!=typeof e[Symbol.iterator]||e instanceof Node||e instanceof Date||e instanceof RegExp)}function s(e){return o(e)?Array.from(e).flatMap(s):[e]}function a(e){for(;"function"==typeof e;)e=e.call(r,r);return o(e)?Array.from(e).flatMap(a):[e]}}}})},configurable:!1,enumerable:!0},$html:{get(){return this.$dom("http://www.w3.org/1999/xhtml")},configurable:!1,enumerable:!0},$svg:{get(){return this.$dom("http://www.w3.org/2000/svg")},configurable:!1,enumerable:!0},$mml:{get(){return this.$dom("http://www.w3.org/1998/Math/MathML")},configurable:!1,enumerable:!0}}),Object.defineProperties(Window.prototype,{$dom:{get(){return this.document.$dom},configurable:!1,enumerable:!0},$html:{get(){return this.document.$html},configurable:!1,enumerable:!0},$svg:{get(){return this.document.$svg},configurable:!1,enumerable:!0},$mml:{get(){return this.document.$mml},configurable:!1,enumerable:!0}});const observable=function(e){let t=e;const r=baseObservable(function(e){return 0===arguments.length||Object.is(t,e)||r.tryChange(()=>t=e,{oldValue:t,newValue:e}),t});return Object.setPrototypeOf(r,observable.prototype),r.bind=Object.create(observable.prototype.bind),r.bind.__observable__=r,r.bind.to=Object.setPrototypeOf(Object.assign((...e)=>r(...e),{type:"to"}),r),r.bind.from=Object.setPrototypeOf(Object.assign((...e)=>r(...e),{type:"from"}),r),r};Object.setPrototypeOf(observable.prototype,baseObservable.prototype),Object.setPrototypeOf(observable,baseObservable),Object.defineProperties(observable.prototype,{type:{value:"two-way",writable:!1,configurable:!1,enumerable:!0},value:{get(){return this()},set(e){return this(e)},configurable:!1,enumerable:!0},[Symbol.toStringTag]:{value:"observable",writable:!1,configurable:!1,enumerable:!1}}),observable.prototype.optimistic=function(e,t){const r=this();return this(e(r)),t.catch(e=>{throw this(r),e})},observable.prototype.bind=Object.create(baseObservable.prototype.bind),observable.prototype.bind.__observable__=observable.prototype;
//# sourceMappingURL=dom.min.js.map
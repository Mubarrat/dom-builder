/*!
 * Dom-Builder JavaScript Library v3.0.0
 * https://github.com/Mubarrat/dom-builder/
 * 
 * Released under the MIT license
 * https://github.com/Mubarrat/dom-builder/blob/main/LICENSE
 */
function base_observable(e,t){return e.subscribe=e=>(t.add(e),()=>t.delete(e)),e.notify=()=>t.forEach(t=>t(e())),e.bind=()=>({[Symbol.observable]:"one-way",target:e}),e.bindSelect=t=>({[Symbol.observable]:"select",target:e,selector:t}),e.bindMap=t=>e.bindSelect(e=>{if(!Array.isArray(e))throw new Error("bindMap requires an array");return e.map(t)}),e}function observable(e=null){let t=e;const r=base_observable(function(e){return 0!==arguments.length&&t!==e&&(t=e,r.notify()),t},new Set);return r.bindToSource=()=>({[Symbol.observable]:"to-source",target:r}),r.bindTwoWay=()=>({[Symbol.observable]:"two-way",target:r}),r}function validatable(e=()=>!0,t=null){const r=observable(t);return r.isValid=(()=>e(r())).computed(r),r}Symbol.observable=Symbol("observable"),Function.prototype.computed=function(...e){const t=base_observable(this,new Set);return e.forEach(e=>e.subscribe(t.notify)),t},Object.defineProperties(Document.prototype,{$dom:{value(e){return new Proxy({},{get:(t,r)=>{const o=r.replace(/([A-Z])/g,"-$1").toLowerCase();return(...t)=>{const r=this.createElementNS(e,o);for(const e of t.flat(1/0))if(null!=e&&!1!==e)if(e.constructor===Object){for(const[t,o]of Object.entries(e))if("style"===t)switch(o?.[Symbol.observable]){case"one-way":Object.assign(r.style,o.target()),o.target.subscribe(e=>Object.assign(r.style,e));break;case"to-source":case"two-way":throw new Error("Two-way style binding not supported");default:if("object"==typeof o)for(const[e,t]of Object.entries(o))"one-way"===t?.[Symbol.observable]?(r.style[e]=t.target(),t.target.subscribe(t=>r.style[e]=t)):r.style[e]=t}else if("on"===t&&"object"==typeof o)for(const[e,t]of Object.entries(o))for(const o of[t].flat(1/0))"function"==typeof o&&r.addEventListener(e.toLowerCase(),o);else if(t.startsWith("on"))for(const e of[o].flat(1/0))"function"==typeof e&&r.addEventListener(t.slice(2).toLowerCase(),e);else if("data"===t&&"object"==typeof o)for(const e in o){const t=o[e],a=t=>r.dataset[e]="object"==typeof t?JSON.stringify(t):t;switch(t?.[Symbol.observable]){case"one-way":a(t.target()),t.target.subscribe(a);break;case"to-source":a(t.target()),new MutationObserver(o=>{for(const a of o)if("attributes"===a.type){const o=r.dataset[e];try{t.target(JSON.parse(o))}catch{t.target(o)}}}).observe(r,{attributes:!0,attributeFilter:[`data-${e}`]});break;case"two-way":a(t.target()),t.target.subscribe(a),new MutationObserver(o=>{for(const a of o)if("attributes"===a.type){const o=r.dataset[e];try{t.target(JSON.parse(o))}catch{t.target(o)}}}).observe(r,{attributes:!0,attributeFilter:[`data-${e}`]});break;default:a(t)}}else if(t.toLowerCase().startsWith("ref"))for(const e of[o].flat(1/0))"function"==typeof e&&e.bind(r,r);else if("value"===t&&(r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement))switch(o?.[Symbol.observable]){case"one-way":r.value=o.target(),o.target.subscribe(e=>r.value=e);break;case"to-source":r.value=o.target(),r.addEventListener(r instanceof HTMLSelectElement?"change":"input",()=>o.target(r.value));break;case"two-way":r.value=o.target(),o.target.subscribe(e=>r.value=e),r.addEventListener(r instanceof HTMLSelectElement?"change":"input",()=>o.target(r.value));break;default:r.value=o}else if("checked"===t&&r instanceof HTMLInputElement&&("checkbox"===r.type||"radio"===r.type))switch(o?.[Symbol.observable]){case"one-way":r.checked=o.target(),o.target.subscribe(e=>r.checked=e);break;case"to-source":r.checked=o.target(),r.addEventListener("change",()=>o.target(r.checked));break;case"two-way":r.checked=o.target(),o.target.subscribe(e=>r.checked=e),r.addEventListener("change",()=>o.target(r.checked));break;default:r.checked=o}else if(void 0!==o){const e=e=>{t in r?r[t]=e:r.setAttribute(t,"object"==typeof e?JSON.stringify(e):e)};switch(o?.[Symbol.observable]){case"one-way":e(o.target()),o.target.subscribe(e);break;case"to-source":e(o.target()),new MutationObserver(e=>{for(const a of e){let e;e=t in r?r[t]:r.getAttribute(t);try{o.target(JSON.parse(e))}catch{o.target(e)}}}).observe(r,{attributes:!0,attributeFilter:[t],attributeOldValue:!0});break;case"two-way":e(o.target()),o.target.subscribe(e),new MutationObserver(e=>{for(const a of e){let e;e=t in r?r[t]:r.getAttribute(t);try{o.target(JSON.parse(e))}catch{o.target(e)}}}).observe(r,{attributes:!0,attributeFilter:[t],attributeOldValue:!0});break;default:e(o)}}}else{const t=[e];for(;t.length;){let e=t.pop();if(null!=e&&!1!==e){for(;"function"==typeof e;)e=e();Array.isArray(e)?t.push(...e.reverse()):e instanceof Node?r.append(e):r.append(this.createTextNode(String(e)))}}}return r}}})},configurable:!1,enumerable:!0},$html:{get(){return this.$html=this.$dom("http://www.w3.org/1999/xhtml")},configurable:!1,enumerable:!0},$svg:{get(){return this.$svg=this.$dom("http://www.w3.org/2000/svg")},configurable:!1,enumerable:!0},$mml:{get(){return this.$mml=this.$dom("http://www.w3.org/1998/Math/MathML")},configurable:!1,enumerable:!0}}),Function.prototype.recreate=function(...e){const t=this;let r=[t(o)].flat(1/0);function o(){const e=[t(o)].flat(1/0);r[0]&&(r[0].before(...e),r.forEach(e=>e.remove()),r=e,r.update=o)}return e.flat(1/0).forEach(e=>e.subscribe(o)),r.update=o,r},Function.prototype.reupdate=function(...e){const t=this;let r=t(s);function o(e,t){if(!e||!t)return!1;if(e.nodeType!==t.nodeType)return!1;if(3===e.nodeType)// Text node
return e.textContent===t.textContent;if(e.tagName!==t.tagName)return!1;if((e.id||void 0)!==(t.id||void 0))return!1;return(e.getAttribute("name")||void 0)===(t.getAttribute("name")||void 0)}function a(e,t){const r=e.attributes,o=t.attributes;for(let o=r.length-1;o>=0;o--){const a=r[o];t.hasAttribute(a.name)||e.removeAttribute(a.name)}for(let t=0;t<o.length;t++){const r=o[t];e.getAttribute(r.name)!==r.value&&e.setAttribute(r.name,r.value)}(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&("value"in e&&e.value!==t.value&&(e.value=t.value),"checked"in e&&e.checked!==t.checked&&(e.checked=t.checked),"selected"in e&&e.selected!==t.selected&&(e.selected=t.selected))}function n(e,t,r){t=Array.from(t),r=Array.from(r);const s=t.map(e=>({node:e,checked:!1}));let c=null;for(const t of r){let r=s.find(({node:e,checked:r})=>!r&&o(e,t));r?(r.checked=!0,c=r.node,1===r.node.nodeType?(a(r.node,t),n(r.node,r.node.childNodes,t.childNodes)):3===r.node.nodeType&&r.node.textContent!==t.textContent&&(r.node.textContent=t.textContent)):(c?c.after(t):e.prepend(t),c=t)}for(const{node:e,checked:t}of s)t||e.remove()}function s(){const e=t(s),c=(Array.isArray(r)?r[0]?.ownerDocument:r?.ownerDocument)||document;if(Array.isArray(r)&&Array.isArray(e)){const t=r[0]?.parentNode;if(!t)return;n(t,r,e)}else if(Array.isArray(r)||Array.isArray(e)){if(Array.isArray(r)){const t=r[0]?.parentNode;if(!t)return;const o=c.createComment("");t.insertBefore(o,r[0]),r.flat(1/0).forEach(e=>t.removeChild(e)),e.flat(1/0).forEach(e=>t.insertBefore(e,o)),t.removeChild(o)}else{const t=r.parentNode;if(!t)return;t.replaceChild(e,r)}r=e}else{const t=r.parentNode;if(!t)return;o(r,e)?(a(r,e),n(t,r.childNodes,e.childNodes)):(t.replaceChild(e,r),r=e)}r.update=s}return e.flat(1/0).forEach(e=>e.subscribe(s)),r.update=s,r},Object.defineProperties(Window.prototype,{$dom:{get(){return this.document.$dom},configurable:!1,enumerable:!0},$html:{get(){return this.document.$html},configurable:!1,enumerable:!0},$svg:{get(){return this.document.$svg},configurable:!1,enumerable:!0},$mml:{get(){return this.document.$mml},configurable:!1,enumerable:!0}});